{"id":"rifvdm-02v","title":"Survey Combs2024 vdM database schema + size drivers; decide re-encoding format","description":"Inspect Combs2024 vdM parquet DB schema + decide re-encoding format. Local DB path: ~/practice_arena/050_test_COMBS/Combs2024/database/database/ (vdMs/ ~5.2GB, 354 *.parquet.gzip across 18 CG folders). Identify minimal fields needed for vdM-\u003evdXform: cluster_id, residue identity, interacting-atom mapping, transform from CG frame to residue stub, and priors from C_score/cluster_rank.","notes":"Schema+scale snapshot (local DB ~/practice_arena/.../vdMs): 354 parquet files (~5.2GB). Instance key is (rota, CG, probe_name) and in sampled files each instance is a 3-residue microenvironment: chain=='Y' are iFG/CG atoms for superposition; chain=='X' are the 3 residues. For MTX CG typing: 8 CG occurrences across ph/coo/ccn/conh2; those CG types total ~584k unique probe_name in DB; naive placement across all occurrences is ~1.2M 3mers before pruning.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T09:54:18.71222653+08:00","created_by":"zpzeng","updated_at":"2026-01-09T10:54:22.114933163+08:00","closed_at":"2026-01-09T10:54:22.114933163+08:00","close_reason":"Closed"}
{"id":"rifvdm-1qi","title":"Survey rifgen sampling loops + scaling limits (rotamers, hb geoms, per-voxel caps)","description":"Read rifdock/rifgen code paths to quantify sampling complexity and memory: how many RelRotPos per HB job, how per-voxel top-K is enforced (RotamerScores\u003cN\u003e), what rif_type options imply, what defaults in rifgen.flag mean. Produce scaling spreadsheet + hard limits + design constraints for vdM insertion.","notes":"Findings: (1) RIF per-voxel top-K is fixed (e.g., RotScore64 K=28; RotScoreSat K=14; RotScoreSat_2x16 K=19). (2) RIF rotamer id is bit-packed: most rif types use RotamerBits=9 (max 512 ids); Rot10Score6Sat16 uses RotamerBits=10 (max 1024). This is a hard cap for any vdM-\u003eRIF export. (3) UserHotspots generator is non-deterministic by default (seed time(0)). See docs/design_plan.md for details.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T09:54:15.371968935+08:00","created_by":"zpzeng","updated_at":"2026-01-09T10:54:21.999085449+08:00","closed_at":"2026-01-09T10:54:21.999085449+08:00","close_reason":"Closed"}
{"id":"rifvdm-2j5","title":"Write docs: quickstart + data format spec + milestones","description":"Create docs/quickstart.md, docs/changelog.md, docs/takeaway.md and keep them updated. Quickstart should show repo layout, how to download Combs DB, how to run converter + candidate generation, and how to reproduce outputs.","notes":"Updated docs: quickstart now uses uv (3.11) + rdkit extra; design_plan now includes MTX CG typing + DB scale + RotamerBits cap; takeaway updated with env notes; changelog updated. Remaining doc TODO: add converter/candidate scripts once implemented.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T09:54:39.868382846+08:00","created_by":"zpzeng","updated_at":"2026-01-09T10:54:28.265901897+08:00","closed_at":"2026-01-09T10:54:28.265901897+08:00","close_reason":"Closed","dependencies":[{"issue_id":"rifvdm-2j5","depends_on_id":"rifvdm-k8y","type":"blocks","created_at":"2026-01-09T09:58:06.216809814+08:00","created_by":"zpzeng"}]}
{"id":"rifvdm-32z","title":"Add symmetry-aware site frames beyond coo (e.g., ph ring CD1/CD2)","description":"Some cg types are symmetric in ligands (e.g., aromatic rings), and mapping to Combs iFG labels can mirror frames and misplace vdM residues. After fixing coo swaps, extend symmetry handling to other cg types and add regression tests to ensure motifs remain clash-free and satisfy polar atoms.","notes":"Follow-up to rifvdm-ljd: coo now emits swap frames (OD1/OD2 and OE1/OE2). Need to evaluate other symmetric cg types (e.g., ph/phenol ring atoms CD1/CD2, possibly others) and decide whether to emit swapped/rotated frames or use symmetry-invariant frame definitions. Add MTX+another ligand regression cases to confirm no mirrored vdM placements/clashes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T21:06:21.484006822+08:00","created_by":"zpzeng","updated_at":"2026-02-02T18:28:14.829435748+08:00","closed_at":"2026-02-02T18:28:14.829435748+08:00","close_reason":"Implemented aromatic (ph/phenol) swap frames + added regression harness."}
{"id":"rifvdm-453","title":"Initialize git remote and push run-log repo","description":"This workspace has no git commits yet and no git remote configured, but AGENTS.md mandates push at end of session.\n\nNeed from user:\n- remote URL (SSH) and desired default branch name.\n\nThen:\n- git add/commit\n- bd sync\n- git push\n\nAcceptance:\n- git status shows up-to-date with origin.\n","acceptance_criteria":"Remote configured; initial commit pushed; bd sync done.","notes":"Configured remote origin=ssh://git@github.com/Molaison/vdRIF.git; renamed branch to main; pushed successfully. Verified: git status shows up to date with origin/main.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T17:22:33.697628693+08:00","created_by":"zpzeng","updated_at":"2026-01-10T17:45:45.341737993+08:00","closed_at":"2026-01-10T17:45:45.341744538+08:00"}
{"id":"rifvdm-50s","title":"Design vdM-\u003evdXform compact file format + conversion script from parquet","description":"Design on-disk format (vdXform) optimized for rifgen reading: per-CG list of cluster representatives with rigid transform(s), residue identity, score priors (C_score, cluster_rank), and optional metadata. Also implement converter from Combs parquet DB.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T09:54:27.945797593+08:00","created_by":"zpzeng","updated_at":"2026-01-09T12:20:00.095609273+08:00","closed_at":"2026-01-09T12:20:00.095609273+08:00","close_reason":"Closed","dependencies":[{"issue_id":"rifvdm-50s","depends_on_id":"rifvdm-02v","type":"blocks","created_at":"2026-01-09T09:58:02.229478513+08:00","created_by":"zpzeng"},{"issue_id":"rifvdm-50s","depends_on_id":"rifvdm-1qi","type":"blocks","created_at":"2026-01-09T09:58:03.275593283+08:00","created_by":"zpzeng"},{"issue_id":"rifvdm-50s","depends_on_id":"rifvdm-c8x","type":"blocks","created_at":"2026-01-09T10:07:45.751609108+08:00","created_by":"zpzeng"}],"comments":[{"id":2,"issue_id":"rifvdm-50s","author":"zpzeng","text":"Implemented vdXform v0 parquet→npz converter (per-AA parts + packer) and wrote docs/vdxform_spec.md. Converter computes X_ifg_to_stub from chain Y iFG frame (configs/cg_frame_defs.json supports multiple atom-name variants) to rifdock-compatible stub frame (BackboneActor.from_n_ca_c). Debug run: scripts/03_vdxform/01_run_coo_debug.sh builds processed/03_vdxform/coo/vdxform_coo.npz (10k entries capped).","created_at":"2026-01-09T04:19:47Z"}]}
{"id":"rifvdm-66b","title":"Decide vdXform export entity: chain X resnum==10 vs flanks","notes":"Resolved: vdXform should export the interaction residue = chain X resnum==10 (center residue). Flanks (resnum 9/11) are not exported. Confirmed by DeepWiki + parquet scans; candidate pipeline now generates clash-free motif with this choice.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T00:50:13.125969097+08:00","created_by":"zpzeng","updated_at":"2026-01-10T10:28:24.991726892+08:00","closed_at":"2026-01-10T10:28:24.991732739+08:00"}
{"id":"rifvdm-7yz","title":"Polar-focused candidate filtering (no backbone-only hbonds; exclude PRO/CYS)","description":"Implement prefilters to focus on polar satisfaction: (1) treat satisfaction as sidechain-only (avoid backbone N/O hbonds dominating); (2) allow excluding amino acids like PRO/CYS; (3) optional vdxform-level filtering to drop vdMs with no sidechain polar atoms.","notes":"Added centroid-facing constraint in candidate filter: scripts/04_candidates/01_generate_candidates.py now also requires dot(CA-\u003eCB, CA-\u003elig_centroid) \u003e= --min-sidechain-centroid-dot (default 0.0) in addition to dot to covered polar sites. This removes cases like mtx_det_facing_fix_obj_min_count where M1/M6 had dot_to_centroid\u003c0 even though dot_to_cov\u003e0. Verified by real run: processed/99_harness/mtx_det_centroid_facing0/B motif has all residues dot_centroid\u003e0, all_satisfied=true, internal clash ok, deterministic=true.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T23:38:56.07377962+08:00","created_by":"zpzeng","updated_at":"2026-01-11T18:29:23.995574576+08:00","closed_at":"2026-01-11T08:53:28.581364718+08:00","close_reason":"Closed"}
{"id":"rifvdm-8np","title":"Define ligand polar-atom/functional-group typing + CG frames compatible with Combs CGs","description":"Define deterministic ligand polar-atom typing and Combs CG frames. Use existing local tool for CG detection + atom mapping: ~/practice_arena/050_test_COMBS/vdm_designer/vdm_core/generate_cg_atommap.py (SMARTS + connectivity ordering aligned with Combs cg_dicts.txt). Output should include per-CG ligand atom ordering (lgd_sel) matching correspond_names, and frame definition rules for placement/superposition.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T09:54:23.472744324+08:00","created_by":"zpzeng","updated_at":"2026-01-09T12:20:00.06065865+08:00","closed_at":"2026-01-09T12:20:00.06065865+08:00","close_reason":"Closed","comments":[{"id":1,"issue_id":"rifvdm-8np","author":"zpzeng","text":"Implemented deterministic ligand polar-site extraction (RDKit features + donor requires attached H) and coverage checks vs cg_atommap. For MTX: cg_atommap missed NA2/NA4 donors; added deterministic fallback to map uncovered donors to Combs iFG type bb_cnh using (CA,N,H)=(heavy_neighbor,N,smallest-H). Outputs: outputs/02_polar_sites/MTX_polar_sites.json, outputs/02_polar_sites/MTX_site_frames.json (uncovered=[]).","created_at":"2026-01-09T04:19:44Z"}]}
{"id":"rifvdm-8o3","title":"Determinism + performance regression harness","description":"Add a small, reproducible harness that runs: (1) cgmap on MTX; (2) converter on a tiny parquet slice; (3) candidate enumeration; (4) motif solve. Assert byte-identical outputs across repeated runs and record runtimes/memory. Needed to keep the large project stable across iterations.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T10:54:59.915265564+08:00","created_by":"zpzeng","updated_at":"2026-01-09T18:43:04.565983629+08:00","closed_at":"2026-01-09T18:43:04.565983629+08:00","close_reason":"Closed","dependencies":[{"issue_id":"rifvdm-8o3","depends_on_id":"rifvdm-k8y","type":"discovered-from","created_at":"2026-01-09T10:54:59.917955006+08:00","created_by":"zpzeng"}],"comments":[{"id":6,"issue_id":"rifvdm-8o3","author":"zpzeng","text":"Added MTX determinism regression harness: scripts/99_harness/01_mtx_determinism_regression.py (+ wrapper .sh). It runs candidate generation and CP-SAT solve twice into separate folders and checks sha256 equality for candidates and motif outputs. Also adjusted solver report to store candidates file hashes (sha256) instead of run-path-dependent file paths, so determinism checks are meaningful.","created_at":"2026-01-09T10:43:04Z"}]}
{"id":"rifvdm-azr","title":"Run CG atom mapping for MTX ligand pose","description":"Use local script generate_cg_atommap.py to identify Combs CGs in MTX bound-pose ligand and write deterministic JSON mapping. Input: inputs/01_cgmap/MTX.pdb (copied from ligand bench). Output: outputs/01_cgmap/MTX_cg_atommap.json + logs.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T10:12:21.746969705+08:00","created_by":"zpzeng","updated_at":"2026-01-09T10:35:25.274389794+08:00","closed_at":"2026-01-09T10:35:25.274389794+08:00","close_reason":"Closed"}
{"id":"rifvdm-c8x","title":"Set up modern Python env for parquet IO (pyarrow) + OR-Tools solver","description":"Blocker for parquet -\u003e vdXform conversion and deterministic motif solver. Current workspace python3=3.6.8 lacks pyarrow/fastparquet; plan: set up a modern Python env using **uv** (preferred) or pixi. Repo includes pyproject.toml (python\u003e=3.11) with deps: numpy/pandas/pyarrow/ortools; run: uv python install 3.11 \u0026\u0026 uv lock \u0026\u0026 uv sync. Document exact steps + any platform caveats.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T10:07:41.809944485+08:00","created_by":"zpzeng","updated_at":"2026-01-09T10:35:25.31681036+08:00","closed_at":"2026-01-09T10:35:25.31681036+08:00","close_reason":"Closed"}
{"id":"rifvdm-d7a","title":"Verify Combs2024 vdMs entity semantics (chain X/Y, cluster_atom, partner residues)","description":"User reports vdMs/ does contain interaction partner residues; our previous scans suggested otherwise. Task: confirm Combs2024 entity semantics for vdMs parquet (chain X/Y, cluster_atom) and verify whether partner residue atoms (e.g., OD/OE, NZ/NH*) can appear in chain X for relevant CG libraries. Use DeepWiki + direct parquet scans to reconcile.","notes":"DeepWiki confirms vdMs parquet semantics: chain Y = CG/iFG atoms (resnum=10); chain X includes extended segment with resnum 9/10/11; interaction residue is chain X resnum==10. Converter now enforces exporting chain X resnum==10 and uses chain Y to build iFG frame.","status":"closed","priority":1,"issue_type":"task","assignee":"zpzeng","created_at":"2026-01-10T00:46:46.461667422+08:00","created_by":"zpzeng","updated_at":"2026-01-10T10:28:20.195445832+08:00","closed_at":"2026-01-10T10:28:20.195491016+08:00"}
{"id":"rifvdm-dyz","title":"Clarify git remote/push policy for this run-log repo","description":"AGENTS.md requires ending sessions with git push, but this project_run_log repo currently has no git remote configured. Decide whether to add a remote, disable the rule for this repo, or treat it as local-only. Document the decision.","status":"closed","priority":3,"issue_type":"chore","created_at":"2026-01-09T10:55:02.040679144+08:00","created_by":"zpzeng","updated_at":"2026-01-09T12:21:20.29661212+08:00","closed_at":"2026-01-09T12:21:20.29661212+08:00","close_reason":"Closed","dependencies":[{"issue_id":"rifvdm-dyz","depends_on_id":"rifvdm-k8y","type":"discovered-from","created_at":"2026-01-09T10:55:02.043499191+08:00","created_by":"zpzeng"}],"comments":[{"id":3,"issue_id":"rifvdm-dyz","author":"zpzeng","text":"Added a clarification note to AGENTS.md: this project_run_log repo may be local-only with no git remote; if no remote, do not invent one, and record progress in bd+docs.","created_at":"2026-01-09T04:21:20Z"}]}
{"id":"rifvdm-e5b","title":"Implement deterministic motif solver: cover all ligand polar atoms with 8–15 residues","description":"Implement deterministic selection of 8–15 residue placements that cover all ligand polar atoms (hard constraint). Likely ILP/CP-SAT with clash constraints and optional buriedness priors. Output motif PDB + JSON audit trail.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-09T09:54:35.241526068+08:00","created_by":"zpzeng","updated_at":"2026-01-09T18:35:23.692401818+08:00","closed_at":"2026-01-09T18:35:23.692401818+08:00","close_reason":"Closed","dependencies":[{"issue_id":"rifvdm-e5b","depends_on_id":"rifvdm-kx4","type":"blocks","created_at":"2026-01-09T09:58:05.469550596+08:00","created_by":"zpzeng"},{"issue_id":"rifvdm-e5b","depends_on_id":"rifvdm-8np","type":"blocks","created_at":"2026-01-09T09:58:05.82099803+08:00","created_by":"zpzeng"},{"issue_id":"rifvdm-e5b","depends_on_id":"rifvdm-c8x","type":"blocks","created_at":"2026-01-09T10:07:45.785180444+08:00","created_by":"zpzeng"}],"comments":[{"id":5,"issue_id":"rifvdm-e5b","author":"zpzeng","text":"Implemented deterministic motif solver (OR-Tools CP-SAT) over candidate placements: hard coverage of all ligand polar atoms, residue count 8–15, and approximate residue–residue clash constraints (N/CA/C/CB) built via a CA spatial grid to avoid O(n^2) scaling. Determinism: require num_workers=1 and lexicographic objective encoding (maximize score, then minimize count, then tie-break by candidate rank). Entry: scripts/05_solver/01_solve_motif.py; MTX demo: scripts/05_solver/01_run_mtx_solver_debug.sh produces outputs/05_solver/MTX_motif_debug.json and outputs/05_solver/MTX_motif_debug.pdb.","created_at":"2026-01-09T10:35:23Z"}]}
{"id":"rifvdm-k8y","title":"[EPIC] vdM × RIFGen: deterministic fully-polar-satisfied ligand motif","description":"Goal: Given a ligand bound pose, generate a deterministic 8–15 residue motif such that every ligand polar atom is satisfied (H-bonds/salt bridges), using vdM statistics (Combs) for geometry priors and RIFGen-style discretized 6D field for scalable enumeration/compression. Deliverables: (1) candidate generator spec; (2) compact vdM transform library format; (3) motif solver spec; (4) docs + milestones.","design":"MTX debug milestone (2026-01-10): end-to-end run produces a deterministic 8–15 residue motif that (a) satisfies all ligand polar atoms and (b) has zero severe ligand–motif vdW overlaps.\n\nKey semantic decision (Combs2024 vdMs parquet):\n- chain Y = CG/iFG atoms (used to build the iFG frame; resnum=10)\n- chain X = interacting AA segment with resnum 9/10/11; interaction residue is chain X resnum==10.\n- Therefore vdXform exports the *interaction residue* = chain X resnum==10, and stores its atoms in stub-local coordinates; X_ifg_to_stub is computed from (chain Y iFG frame) to (chain X stub frame from N/CA/C).\n\nHard success criteria (debug):\n- outputs/05_solver/MTX_motif_debug_validation.json: all_satisfied==true\n- outputs/05_solver/MTX_motif_debug_clash_validation.json: ok==true\n\nRepro (debug, clean):\n- bash scripts/01_cgmap/01_run_mtx_cgmap.sh\n- bash scripts/02_polar_sites/01_run_mtx_polar_sites.sh\n- rm -rf processed/03_vdxform/{coo,conh2,ccn,ph,bb_cnh} processed/04_candidates/MTX_candidates_debug.* outputs/05_solver/MTX_motif_debug*\n- bash scripts/03_vdxform/03_run_mtx_needed_cgs_debug.sh\n- bash scripts/04_candidates/01_run_mtx_candidates_debug.sh\n- bash scripts/05_solver/01_run_mtx_solver_debug.sh\n\nDeterminism regression: scripts/99_harness/01_run_mtx_determinism_regression.sh (compares candidates+motif byte-identical across two runs).","notes":"Important correction (2026-01-09): the previously produced MTX motif passed polar-satisfaction validation but had severe ligand clashes (vdW overlap \u003e2 Å). Root cause: we mistakenly exported/placed the iFG residue itself, which overlays ligand-matched CG atoms. Added hard clash validator (scripts/05_solver/04_validate_motif_clashes.py) and full-atom ligand clash filtering in candidate generation (scripts/04_candidates/01_generate_candidates.py) so we cannot claim success without clash-free geometry.\n\nBigger blocker: the current local Combs2024 database at /xcfhome/zpzeng/practice_arena/050_test_COMBS/Combs2024/database/database/vdMs appears to encode residue local neighborhoods, not interaction partners. Empirically: scanning 200 instances from /xcfhome/zpzeng/practice_arena/050_test_COMBS/Combs2024/database/database/vdMs/ccn/LYS.parquet.gzip shows 0 cases where any non-iFG residue OD/OE is within 4 Å of iFG NZ (no salt-bridge-like contacts). Similarly for /xcfhome/zpzeng/practice_arena/050_test_COMBS/Combs2024/database/database/vdMs/coo/ASP.parquet.gzip: 0/200 with any non-iFG cation atom within 4 Å of iFG OD/OE. Therefore this DB cannot satisfy ligand cations (e.g., MTX N5 typed as cation) via microenvironment residues.\n\nDecision needed:\n(A) Use or generate a ligand-iFG vdM DB (protein–ligand complexes) that contains actual interacting residues for each ligand iFG.\n(B) Add a rifgen-style inverse-rotamer fallback for ionic/HB interactions for sites that the current vdMs cannot cover.","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2026-01-09T09:54:11.762891669+08:00","created_by":"zpzeng","updated_at":"2026-01-10T10:28:37.304877301+08:00","comments":[{"id":7,"issue_id":"rifvdm-k8y","author":"zpzeng","text":"Pipeline MVP now exists end-to-end for MTX: scripts/01_cgmap/01_run_mtx_cgmap.sh → scripts/02_polar_sites/01_run_mtx_polar_sites.sh → vdXform conversion (debug: scripts/03_vdxform/03_run_mtx_needed_cgs_debug.sh; full: scripts/03_vdxform/02_run_mtx_needed_cgs.sh on dg) → candidates (scripts/04_candidates/02_run_mtx_candidates.sh) → solve motif (scripts/05_solver/02_run_mtx_solver.sh). Determinism harness: scripts/99_harness/01_run_mtx_determinism_regression.sh.","created_at":"2026-01-09T10:44:16Z"},{"id":8,"issue_id":"rifvdm-k8y","author":"zpzeng","text":"Jan 13 2026: Full-scale vdXform libs built in processed/03_vdxform_full (coo 348142, conh2 303932, ccn 145248, ph 417170, bb_cnh 314744 entries). Determinism harness passed on full libs with top_per_site=200: processed/99_harness/mtx_det_full_vdxform_det_top200/report.json (A/B identical; candidates_s≈191-193s; solve_s≈144s). Candidate generation was refactored to prune by geometric satisfaction + sidechain-facing before full-atom ligand clash checking; top-k maintenance now uses heapq (deterministic tie). Verified real motif output: processed/99_harness/mtx_full_vdxform_single/MTX_motif_top200.pdb passes polar satisfaction + ligand clash + motif-internal clash validators.","created_at":"2026-01-12T18:40:48Z"}]}
{"id":"rifvdm-k8y.1","title":"Quantify vdM cluster counts vs RotamerBits","description":"Compute quantitative limits for mapping vdMs to rifdock RIF rotamer IDs.\n\nTasks:\n- For CGs used by MTX (coo, conh2, ccn, ph, bb_cnh), scan the Combs2024 vdMs parquet DB and report:\n  - #instances (unique (rota,CG,probe_name))\n  - #unique cluster_number\n  - cluster_number max/min\n  - distribution of cluster sizes (optional)\n- Decide feasible mapping strategies under RotamerBits cap (\u003c=512 or \u003c=1024) and record recommendation.\n\nDeliverables:\n- processed/06_stats/vdm_cluster_stats.json\n- docs/irot_compression_plan.md (or section in docs/design_plan.md)\n","acceptance_criteria":"Stats JSON exists; decision documented; beads notes updated.","notes":"Completed initial quantitative scan.\n\nOutput: processed/06_stats/mtx_vdm_db_stats.json\nKey numbers (MTX CGs):\n- instances: coo 348,142; conh2 303,932; ccn 145,248; ph 417,170; bb_cnh 314,744\n- distinct cluster_number: coo 4,182; conh2 4,097; ccn 2,062; ph 4,143; bb_cnh 1,211\n\nDecision doc: docs/irot_compression_plan.md (Strategy A: compress to \u003c=1024 as MVP; Strategy B: widen RotamerBits; Strategy C: hybrid).}","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T17:13:25.601356222+08:00","created_by":"zpzeng","updated_at":"2026-01-10T17:19:52.350244267+08:00","closed_at":"2026-01-10T17:19:52.350274118+08:00","dependencies":[{"issue_id":"rifvdm-k8y.1","depends_on_id":"rifvdm-k8y","type":"parent-child","created_at":"2026-01-10T17:13:25.605023689+08:00","created_by":"zpzeng"}]}
{"id":"rifvdm-k8y.2","title":"Map rifgen discretization/storage to vdM motifs","description":"Deep-dive rifdock/rifgen RIF generation and propose how to reuse it for vdM-driven ligand motifs.\n\nQuestions to answer:\n- What are the discretization parameters (hash_cart_resl, hash_angle_resl), what is stored per voxel/bin (topK rotamers), and what templates (RotScoreSat*, RotScore*) impose RotamerBits and K?\n- Where to hook custom rotamer/interaction libraries (RotamerIndexSpec / modify_rotamer_spec)?\n- How to represent vdM clusters as a bounded irot library compatible with rifdock.\n\nDeliverables:\n- docs/rifgen_integration_notes.md (with file/class pointers)\n- A concrete interface proposal: inputs/outputs and where code changes would land (minimal patch vs deeper refactor).\n","acceptance_criteria":"Doc describes exact classes/files and proposed integration points.","notes":"C2 code is now tracked as patch file to keep submodule clonable: external/patches/rifdock/0001-add-Rot12ScoreSat96.patch. After applying, use -rifgen::rif_type Rot12ScoreSat96.","status":"in_progress","priority":1,"issue_type":"task","created_at":"2026-01-10T17:13:29.608501016+08:00","created_by":"zpzeng","updated_at":"2026-01-10T17:40:40.213056905+08:00","dependencies":[{"issue_id":"rifvdm-k8y.2","depends_on_id":"rifvdm-k8y","type":"parent-child","created_at":"2026-01-10T17:13:29.61122652+08:00","created_by":"zpzeng"}]}
{"id":"rifvdm-k8y.3","title":"Design vdXform→RIF export format","description":"Define a data format and build pipeline that turns Combs vdXform (X_ifg_to_stub + residue atoms + priors) into a rifdock-readable RIF (or an intermediate mmap-friendly store).\n\nConstraints:\n- Must be streamable/resumable; deterministic.\n- Must encode per-entry: irot id, score/prior, and optionally polar satisfaction bitmask.\n- Must support huge raw vdM counts (10^5–10^7) via clustering/compaction.\n\nDeliverables:\n- docs/vdxform_to_rif_spec.md\n- scripts/?? that can export a small debug RIF for MTX for validation.\n","acceptance_criteria":"Spec doc exists; debug export plan clear.","notes":"Draft spec written: docs/vdxform_to_rif_spec.md (inputs, output options, discretization, scoring, satisfaction mapping, determinism/resume, validation). Next: decide intermediate vs direct .rif.gz export for MVP.","status":"in_progress","priority":1,"issue_type":"task","created_at":"2026-01-10T17:13:33.970536463+08:00","created_by":"zpzeng","updated_at":"2026-01-15T09:25:05.420997744+08:00","dependencies":[{"issue_id":"rifvdm-k8y.3","depends_on_id":"rifvdm-k8y","type":"parent-child","created_at":"2026-01-10T17:13:33.973312613+08:00","created_by":"zpzeng"}],"comments":[{"id":10,"issue_id":"rifvdm-k8y.3","author":"zpzeng","text":"Jan 15 2026: Implemented an intermediate vdXform→rifdock export path that avoids reimplementing rifdock XformHash in Python. Candidate NPZ now includes cluster_number_i32. New script scripts/06_rif_export/01_export_rif_inputs.py exports: (1) *_placements.npz with xform_world_stub_12_f32 + irot_id_u16 + (negated) score + sat1/sat2; (2) *_irot_lib.npz mapping irot_id→(aa3,cg,cluster_number)+representative stub-local atoms; (3) *_meta.json with polar_atoms. Tested on MTX full_vdxform top_per_site=2000 (25,083 candidates, 2,505 irots) -\u003e processed/06_rif_export/mtx_top2000/*.","created_at":"2026-01-15T01:38:22Z"}]}
{"id":"rifvdm-k8y.4","title":"Build/validate rifdock Rot12ScoreSat96 on dg","description":"C2 requires rifdock patch to compile and run.\n\nTasks:\n- On dg, build rifdock/rifgen (Rosetta build) with patched submodule commit.\n- Run a tiny rifgen job with -rifgen::rif_type Rot12ScoreSat96 and confirm it writes/reads .rif.gz.\n- Record the measured file size and runtime impact vs RotScoreSat for a small cart_bound.\n\nAcceptance:\n- build succeeds\n- rifgen completes and outputs a RIF\n- notes include exact commands + commit SHAs\n","notes":"Note: external/rifdock submodule is kept at upstream commit; apply patch on dg before building: git -C external/rifdock apply ../patches/rifdock/0001-add-Rot12ScoreSat96.patch.\n\nConnectivity on dg:\n- dg cannot reliably git clone via https://github.com/... (observed OpenSSL SSL_read unexpected EOF and CONNECT tunnel 503).\n- git@github.com over SSH works on dg.\n- scripts/07_dg/01_run_rifdock_rot12_smoke_on_dg.sh supports DG_USE_RSYNC=1 and DG_SUBMODULE_RECURSIVE=0 to avoid nested submodule https fetches.\n\nBlocker: Rosetta version mismatch\n- rifdock README states it requires Rosetta 3.9 or bcov/stable1; dg currently has rosetta.source.release-408.\n- Building rifdock against release-408 fails (boost include path mismatch + API changes like ResidueType::clone deleted).\n- Local build against a Rosetta 2018.09 bundle compiles but rifgen crashes early (heap corruption / invalid free under valgrind), consistent with unsupported Rosetta version.\n\nNext: need a Rosetta 3.9/stable1 checkout on dg (or elsewhere) to complete the Rot12ScoreSat96 build+rifgen smoke acceptance; otherwise we must budget a larger port of rifdock to modern Rosetta.","status":"in_progress","priority":1,"issue_type":"task","created_at":"2026-01-10T17:36:36.097299137+08:00","created_by":"zpzeng","updated_at":"2026-01-10T19:16:29.937407183+08:00","dependencies":[{"issue_id":"rifvdm-k8y.4","depends_on_id":"rifvdm-k8y","type":"parent-child","created_at":"2026-01-10T17:36:36.10018058+08:00","created_by":"zpzeng"}]}
{"id":"rifvdm-kii","title":"Enforce motif internal (residue–residue) clash-free via full-atom constraints","description":"Current solver only constrains residue-residue clashes using N/CA/C/CB, which allows severe sidechain overlaps. Add full-atom clash validation and enforce clash-free motifs (hard constraints) so generated motifs are internally compatible.","notes":"Reproduced severe motif-internal clashes in processed/99_harness/mtx_det_symm_coo_swap/B/MTX_motif.pdb (example: ARG M4:NE vs MET M12:SD dist~0.409Å, overlap~2.44Å). Root cause: solver only enforced residue-residue clashes using fixed BackboneActor N/CA/C/CB local coords + CA grid prefilter; but our stored stub-frame coords (center_atom_xyz_stub_f32) do not match those fixed local coords, so CA prefilter missed true-neighbor pairs (candidate CA distance computed from fixed ca_local differed from PDB CA). Fix: (1) add full-atom residue–residue clash validator scripts/05_solver/05_validate_motif_internal_clashes.py and call it from harness; (2) in scripts/05_solver/01_solve_motif.py build conflict constraints using full-atom world coords derived from center_atom_xyz_stub_f32; compute CA positions from the CA atom in center_atom_xyz_stub_f32 (not hard-coded); (3) fix grid neighbor search radius r=ceil(ca_prefilter/grid_size); (4) increase default/used ca_prefilter to 12.0 to catch longer-range sidechain clashes. Verified by real run: uv run -p 3.11 python scripts/99_harness/01_mtx_determinism_regression.py --tag internal_clash_fix3 =\u003e deterministic=true, all_satisfied=true, ligand clash ok, internal clash ok (worst_overlap=0) in processed/99_harness/mtx_det_internal_clash_fix3/","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T22:07:13.08752623+08:00","created_by":"zpzeng","updated_at":"2026-01-10T22:24:19.311712918+08:00","closed_at":"2026-01-10T22:24:19.311712918+08:00","close_reason":"Closed"}
{"id":"rifvdm-kx4","title":"MVP: deterministic vdM-based RIF generation path (no rifdock C++ changes)","description":"Prototype pipeline without modifying rifdock C++: generate a compressed candidate set from vdM DB in Python, optionally emit rifgen 'hotspots' with zero perturbation or a pre-binned list, and confirm determinism + size feasibility. This is a stepping stone to a native RifGeneratorVdM later.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T09:54:32.43253852+08:00","created_by":"zpzeng","updated_at":"2026-01-09T18:29:41.007487026+08:00","closed_at":"2026-01-09T18:29:41.007487026+08:00","close_reason":"Closed","dependencies":[{"issue_id":"rifvdm-kx4","depends_on_id":"rifvdm-50s","type":"blocks","created_at":"2026-01-09T09:58:04.731832199+08:00","created_by":"zpzeng"},{"issue_id":"rifvdm-kx4","depends_on_id":"rifvdm-8np","type":"blocks","created_at":"2026-01-09T09:58:05.13518453+08:00","created_by":"zpzeng"}],"comments":[{"id":4,"issue_id":"rifvdm-kx4","author":"zpzeng","text":"Implemented MVP candidate-generation path in Python: (1) build ligand site frames with full polar-atom coverage (including deterministic bb_cnh fallback for uncovered donors); (2) convert Combs parquet to compact vdXform npz; (3) generate per-site top-K residue placement candidates with fast ligand clash filtering using rifdock-compatible backbone stub geometry. Main entrypoints: scripts/03_vdxform/02_run_mtx_needed_cgs.sh (full conversion; run on dg), scripts/04_candidates/01_generate_candidates.py + scripts/04_candidates/01_run_mtx_candidates_debug.sh (produces processed/04_candidates/*.npz + *.json).","created_at":"2026-01-09T10:29:36Z"}]}
{"id":"rifvdm-ljd","title":"Redesign ligand site frames for interaction (avoid iFG atom overlap)","notes":"Root cause hypothesis: ligand CG frames were not symmetry-aware for coo (OD1/OD2 and OE1/OE2), so ligand O1/O2 naming could mirror the iFG frame and misplace vdMs. Implemented coo symmetry swap frames in scripts/02_polar_sites/03_build_ligand_site_frames.py (emit extra cgmap:\u003ckey\u003e:swap_* site). Rebuilt MTX site frames: outputs/02_polar_sites/MTX_site_frames.json now n_sites=22, coo sites=8. Ran real harness determinism test: uv run -p 3.11 python scripts/99_harness/01_mtx_determinism_regression.py --tag symm_coo_swap (deterministic=true; all_satisfied=true; worst_overlap=0). Outputs: processed/99_harness/mtx_det_symm_coo_swap/A/MTX_motif.pdb.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T00:50:13.162932722+08:00","created_by":"zpzeng","updated_at":"2026-01-10T21:06:32.599412738+08:00","closed_at":"2026-01-10T21:06:32.599412738+08:00","close_reason":"Closed"}
{"id":"rifvdm-sc6","title":"Define pocket-facing direction (ligand centroid / local normals)","description":"Sidechain-facing filter currently uses CA-\u003ecovered polar site direction; residues can still satisfy peripheral atoms from outside pocket. Add optional additional constraints using ligand centroid or a more physical pocket normal estimate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T18:29:15.560104712+08:00","created_by":"zpzeng","updated_at":"2026-01-13T02:40:54.662469379+08:00","closed_at":"2026-01-13T02:40:54.662469379+08:00","close_reason":"Implemented pocket-facing filter via CA-\u003e(site target) and CA-\u003e(ligand centroid) dot constraints; candidate generator now prunes satisfaction before full-atom clash, and full_vdxform_det_top200 motif outputs show no outward-pointing sidechains."}
{"id":"rifvdm-vcu","title":"Speed up solver / avoid O(n^2) conflicts for large candidate sets","description":"Current CP-SAT solver precomputes pairwise full-atom conflicts in Python loops; becomes intractable when candidate generator outputs ~25k candidates (e.g., top_per_site=2000). Need either: (A) stronger pre-truncation strategy (per-site/per-polar-atom) with justification; (B) implement faster conflict detection (vectorized / chunked) and/or move constraints into RIF-style top-K-per-bin; (C) add optional greedy/ILP-lite solver for MVP. Track benchmarks on 1-core and on dg.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T02:41:04.474917274+08:00","created_by":"zpzeng","updated_at":"2026-01-13T23:11:20.99641157+08:00","closed_at":"2026-01-13T23:11:20.99641157+08:00","close_reason":"Added deterministic greedy solver for large candidate sets; full_vdxform_det_top2000_greedy harness passes with ~25k candidates and solve time ~3s; CP-SAT remains default for exact small-N cases.","comments":[{"id":9,"issue_id":"rifvdm-vcu","author":"zpzeng","text":"Jan 13 2026: Implemented --solver=greedy in scripts/05_solver/01_solve_motif.py to avoid O(n^2) conflict graph. Verified on full vdXform with top_per_site=2000 (~25k candidates): greedy solves in ~2.6–3.2s and determinism harness passes: processed/99_harness/mtx_det_full_vdxform_det_top2000_greedy/report.json (A/B identical) and validations ok.","created_at":"2026-01-13T15:11:12Z"}]}
{"id":"rifvdm-z9v","title":"RIF export strategy under RotamerBits cap","description":"Decide how/if to export vdM-derived candidates into rifdock RIF given RotamerBits (9/10) limits. Compare: (A) cluster vdM placements into \u003c=512/1024 irot library; (B) widen storage types in rifdock (increase RotamerBits / switch Data type), quantify memory impact; (C) keep RIF as optional cache only and store vdm_id in sidecar mapping. Produce a written decision + quantitative tradeoffs.","notes":"Direction change: choose C2 (patch rifdock to widen RotamerBits). Added new rif_type Rot12ScoreSat96 (4096 rotamer ids) in external/rifdock; see docs/rifgen_integration_notes.md + docs/irot_compression_plan.md. Remaining work: compile/validate on dg, then design vdXform→RIF export using this rif_type.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T10:54:57.530442439+08:00","created_by":"zpzeng","updated_at":"2026-02-02T18:28:14.988675637+08:00","closed_at":"2026-02-02T18:28:14.988675637+08:00","close_reason":"Documented C2 decision and quantitative storage impact for Rot12ScoreSat96; validated pipeline harness.","dependencies":[{"issue_id":"rifvdm-z9v","depends_on_id":"rifvdm-k8y","type":"discovered-from","created_at":"2026-01-09T10:54:59.816716928+08:00","created_by":"zpzeng"}]}
